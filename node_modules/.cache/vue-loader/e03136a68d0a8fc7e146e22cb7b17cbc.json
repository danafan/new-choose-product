{"remainingRequest":"/Users/fanyulong/project/2022/choose-product/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/fanyulong/project/2022/choose-product/src/App.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/fanyulong/project/2022/choose-product/src/App.vue","mtime":1684310692559},{"path":"/Users/fanyulong/project/2022/choose-product/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/fanyulong/project/2022/choose-product/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/fanyulong/project/2022/choose-product/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/fanyulong/project/2022/choose-product/node_modules/vue-loader/lib/index.js","mtime":1655715099000}],"contextDependencies":[],"result":["\n  import resource from './api/resource.js'\n  import * as dd from 'dingtalk-jsapi';\n  export default {\n    created() {\n\n      // this.getUserInfo();\n      // return;\n\n      let user_type = localStorage.getItem(\"user_type\");\n      if(!localStorage.getItem(\"cache\") && user_type != '2'){\n        if(dd.env.platform != 'notInDingTalk'){ //是钉钉环境\n          //获取code\n          this.getCode();\n        }else{                                  //不是钉钉环境\n          this.getUserInfo();\n        }\n        \n      }\n      \n      // if(window.location.hash.split('#/')[1] == ''){\n      //   this.$router.replace('/tab_menu')\n      // }\n\n    },\n    watch:{\n      $route:function(n,o){\n        document.title = n.name;\n      }\n    },\n    methods: {\n        //获取code\n      getCode(){\n        dd.ready(() => {\n          dd.runtime.permission.requestAuthCode({\n            corpId: \"ding7828fff434921f5b\",\n            onSuccess: res =>{\n                      //获取钉钉用户信息\n              let code = res.code;\n              this.GetDingUserInfo(code);\n            },\n            onFail : err => {\n              alert('dd error: ' + JSON.stringify(err));\n            }\n          });\n        });\n      },\n          //钉钉获取用户信息\n      GetDingUserInfo(code){\n        resource.dingLogin({code:code}).then(res => {\n          if(res.data.code == 1){\n            this.getUserInfo();\n          }else{\n            this.$message.warning(res.data.msg);\n          }\n        })\n      },\n        //获取用户信息\n      getUserInfo() {\n        resource.getUserInfo().then((res) => {\n          if (res.data.code == 1) {\n            localStorage.setItem(\"cache\",true);\n            let data = res.data.data;\n            localStorage.setItem(\"user_type\", data.user_type);\n            localStorage.setItem(\"ding_user_id\", data.ding_user_id);\n            localStorage.setItem(\"ding_user_name\", data.ding_user_name);\n            localStorage.setItem(\"secret_key\", data.secret_key);\n            localStorage.setItem(\"login_token\", data.login_token);\n            let user_info = {\n              user_type:data.user_type,\n              ding_user_id:data.ding_user_id,\n              login_token:data.login_token,\n              secret_key:data.secret_key\n            }\n            this.$store.commit('setToken',user_info);\n            let domain = data.img_domain;\n            this.$store.commit('setDomain',domain);\n            localStorage.setItem(\"domain\",domain);\n              //获取导航\n            this.getMenuNotice();\n          } else {\n            this.$message.warning(res.data.msg);\n          }\n        });\n      },\n        //获取导航\n      getMenuNotice(){\n        resource.getMenuNotice().then(res => {\n          if(res.data.code == 1){\n            let data = res.data.data;\n            let menu_list = data.menu_list;\n\n            this.$store.commit(\"setMenuList\", menu_list);\n            localStorage.setItem(\"menu_list\",JSON.stringify(menu_list))\n\n            this.$router.replace('tab_menu');\n          }else{\n            this.$message.warning(res.data.msg);\n          }\n        })\n      },\n    },\n  };\n",{"version":3,"sources":["App.vue"],"names":[],"mappings":";AAMA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"App.vue","sourceRoot":"src","sourcesContent":["<template>\n  <div id=\"app\">\n    <router-view></router-view>\n  </div>\n</template>\n<script>\n  import resource from './api/resource.js'\n  import * as dd from 'dingtalk-jsapi';\n  export default {\n    created() {\n\n      // this.getUserInfo();\n      // return;\n\n      let user_type = localStorage.getItem(\"user_type\");\n      if(!localStorage.getItem(\"cache\") && user_type != '2'){\n        if(dd.env.platform != 'notInDingTalk'){ //是钉钉环境\n          //获取code\n          this.getCode();\n        }else{                                  //不是钉钉环境\n          this.getUserInfo();\n        }\n        \n      }\n      \n      // if(window.location.hash.split('#/')[1] == ''){\n      //   this.$router.replace('/tab_menu')\n      // }\n\n    },\n    watch:{\n      $route:function(n,o){\n        document.title = n.name;\n      }\n    },\n    methods: {\n        //获取code\n      getCode(){\n        dd.ready(() => {\n          dd.runtime.permission.requestAuthCode({\n            corpId: \"ding7828fff434921f5b\",\n            onSuccess: res =>{\n                      //获取钉钉用户信息\n              let code = res.code;\n              this.GetDingUserInfo(code);\n            },\n            onFail : err => {\n              alert('dd error: ' + JSON.stringify(err));\n            }\n          });\n        });\n      },\n          //钉钉获取用户信息\n      GetDingUserInfo(code){\n        resource.dingLogin({code:code}).then(res => {\n          if(res.data.code == 1){\n            this.getUserInfo();\n          }else{\n            this.$message.warning(res.data.msg);\n          }\n        })\n      },\n        //获取用户信息\n      getUserInfo() {\n        resource.getUserInfo().then((res) => {\n          if (res.data.code == 1) {\n            localStorage.setItem(\"cache\",true);\n            let data = res.data.data;\n            localStorage.setItem(\"user_type\", data.user_type);\n            localStorage.setItem(\"ding_user_id\", data.ding_user_id);\n            localStorage.setItem(\"ding_user_name\", data.ding_user_name);\n            localStorage.setItem(\"secret_key\", data.secret_key);\n            localStorage.setItem(\"login_token\", data.login_token);\n            let user_info = {\n              user_type:data.user_type,\n              ding_user_id:data.ding_user_id,\n              login_token:data.login_token,\n              secret_key:data.secret_key\n            }\n            this.$store.commit('setToken',user_info);\n            let domain = data.img_domain;\n            this.$store.commit('setDomain',domain);\n            localStorage.setItem(\"domain\",domain);\n              //获取导航\n            this.getMenuNotice();\n          } else {\n            this.$message.warning(res.data.msg);\n          }\n        });\n      },\n        //获取导航\n      getMenuNotice(){\n        resource.getMenuNotice().then(res => {\n          if(res.data.code == 1){\n            let data = res.data.data;\n            let menu_list = data.menu_list;\n\n            this.$store.commit(\"setMenuList\", menu_list);\n            localStorage.setItem(\"menu_list\",JSON.stringify(menu_list))\n\n            this.$router.replace('tab_menu');\n          }else{\n            this.$message.warning(res.data.msg);\n          }\n        })\n      },\n    },\n  };\n</script>"]}]}