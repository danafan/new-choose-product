{"remainingRequest":"/Users/fanyulong/project/2022/choose-product/node_modules/babel-loader/lib/index.js!/Users/fanyulong/project/2022/choose-product/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/fanyulong/project/2022/choose-product/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/fanyulong/project/2022/choose-product/src/pages/SupplyChain/pages/PermissionPages/entry_table.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/fanyulong/project/2022/choose-product/src/pages/SupplyChain/pages/PermissionPages/entry_table.vue","mtime":1664431964727},{"path":"/Users/fanyulong/project/2022/choose-product/babel.config.js","mtime":1662529345111},{"path":"/Users/fanyulong/project/2022/choose-product/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/fanyulong/project/2022/choose-product/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/fanyulong/project/2022/choose-product/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/fanyulong/project/2022/choose-product/node_modules/vue-loader/lib/index.js","mtime":1655715099000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.split\";\nimport TableTitle from \"../../components/table_title.vue\";\nimport PaginationWidget from \"../../../../components/pagination_widget.vue\";\nimport resource from \"../../../../api/chain_resource.js\";\nexport default {\n  data: function data() {\n    return {\n      loading: false,\n      data: {},\n      //返回数据\n      button_list: {},\n      //按钮权限\n      page: 1,\n      //当前页码\n      max_height: 0,\n      //表格最大高度\n      id: \"\",\n      //点击的ID\n      show_dialog: false,\n      //添加或编辑弹窗\n      type: \"\",\n      //弹窗类型（1:添加；2:查看；3编辑）\n      dialog_title: \"\",\n      //弹窗标题\n      access_name: \"\",\n      //权限资源名称\n      menu_list: [],\n      //所属菜单列表\n      props: {\n        expandTrigger: \"hover\",\n        emitPath: false,\n        label: \"menu_name\",\n        value: \"menu_id\",\n        children: \"list\"\n      },\n      menu_id: \"\",\n      //选中的菜单ID\n      controller: [],\n      //所有控制器列表\n      selController: \"\",\n      //当前选择的控制器名称\n      methodList: [],\n      //控制器下所有方法\n      selMethod: \"\",\n      //当前选择的方法名称\n      accessCodes: [],\n      //选中的所有权限码列表\n      is_button: 0,\n      //是否按钮\n      button_name: \"\",\n      //按钮名称\n      access_buts: [],\n      //权限按钮列表\n      button_access_ids: [] //选中的权限按钮列表\n\n    };\n  },\n  created: function created() {\n    //获取列表\n    this.getData();\n  },\n  watch: {\n    selController: function selController(n, o) {\n      if (n != o && n != \"\") {\n        //获取所有控制器列表\n        this.getMethod();\n        this.selMethod = \"\";\n      }\n    }\n  },\n  destroyed: function destroyed() {\n    window.removeEventListener(\"resize\", function () {});\n  },\n  mounted: function mounted() {\n    //获取表格最大高度\n    this.onResize();\n    window.addEventListener(\"resize\", this.onResize());\n  },\n  methods: {\n    //监听屏幕大小变化\n    onResize: function onResize() {\n      var _this = this;\n\n      this.$nextTick(function () {\n        var card_box_height = document.getElementById(\"card_box\").offsetHeight;\n        var table_title_height = document.getElementById(\"table_title\").offsetHeight;\n        var bottom_row_height = document.getElementById(\"bottom_row\").offsetHeight;\n        _this.max_height = card_box_height - table_title_height - bottom_row_height - 55 + \"px\";\n      });\n    },\n    //获取列表\n    getData: function getData() {\n      var _this2 = this;\n\n      var arg = {\n        pagesize: 10,\n        page: this.page\n      };\n      this.loading = true;\n      resource.accessList(arg).then(function (res) {\n        if (res.data.code == 1) {\n          _this2.loading = false;\n          _this2.data = res.data.data;\n          _this2.button_list = _this2.data.button_list;\n        } else {\n          _this2.$message.warning(res.data.msg);\n        }\n      });\n    },\n    //点击添加或编辑\n    addFn: function addFn(type, id) {\n      this.type = type; //获取所有菜单列表\n\n      this.getMenu(); //获取所有控制器列表\n\n      this.getControllers();\n\n      if (type == '1') {\n        //添加\n        this.id = \"\";\n        this.dialog_title = '添加权限';\n      } else {\n        //编辑\n        this.id = id;\n        this.dialog_title = '编辑权限'; //获取权限详情\n\n        this.accessInfo();\n      }\n\n      this.show_dialog = true;\n    },\n    //获取所有菜单列表\n    getMenu: function getMenu() {\n      var _this3 = this;\n\n      resource.getMainMenus().then(function (res) {\n        if (res.data.code == 1) {\n          _this3.menu_list = res.data.data.menu_list;\n        } else {\n          _this3.$message.warning(res.data.msg);\n        }\n      });\n    },\n    //获取权限详情\n    accessInfo: function accessInfo() {\n      var _this4 = this;\n\n      var arg = {\n        id: this.id\n      };\n      resource.accessInfo(arg).then(function (res) {\n        if (res.data.code == 1) {\n          var data = res.data.data;\n          _this4.access_name = data.access_name;\n          _this4.menu_id = data.menu_id;\n          _this4.accessCodes = data.access_codes;\n          _this4.selController = \"\"; //当前选择的控制器名称\n\n          _this4.selMethod = \"\"; //当前选择的方法名称\n\n          _this4.is_button = data.is_button; //是否按钮\n\n          _this4.button_name = data.button_name;\n          var strArr = data.button_access_ids.split(\",\");\n          var intArr = strArr.map(function (item) {\n            return +item;\n          }); //选择按钮的列表\n\n          _this4.changeMenu(_this4.menu_id, intArr);\n        } else {\n          _this4.$mesage.warning(res.data.msg);\n        }\n      });\n    },\n    //获取所有控制器列表\n    getControllers: function getControllers() {\n      var _this5 = this;\n\n      resource.getControllers().then(function (res) {\n        if (res.data.code == 1) {\n          _this5.controller = res.data.data;\n        } else {\n          _this5.$message.warning(res.data.msg);\n        }\n      });\n    },\n    //获取所有控制器下面的方法列表\n    getMethod: function getMethod() {\n      var _this6 = this;\n\n      var arg = {\n        controller_name: this.selController\n      };\n      resource.getMethods(arg).then(function (res) {\n        if (res.data.code == 1) {\n          _this6.methodList = res.data.data;\n        } else {\n          _this6.$message.warning(res.data.msg);\n        }\n      });\n    },\n    //点击弹框的添加权限码\n    addAccessCode: function addAccessCode() {\n      if (this.selController == \"\" || this.selMethod == \"\") {\n        this.$message.warning(\"请完善当前权限码\");\n      } else {\n        var str = this.selController + \"/\" + this.selMethod;\n\n        for (var i = 0; i < this.accessCodes.length; i++) {\n          if (this.accessCodes[i] == str) {\n            this.$message.warning(\"已存在该权限码\");\n            return;\n          }\n        }\n\n        this.accessCodes.push(str);\n      }\n    },\n    //点击某一个关闭\n    handleClose: function handleClose(index) {\n      this.accessCodes.splice(index, 1);\n    },\n    //选择按钮的列表\n    changeMenu: function changeMenu(menu_id, button_access_ids) {\n      var _this7 = this;\n\n      var arg = {\n        menu_id: menu_id\n      };\n      resource.ajaxAccess(arg).then(function (res) {\n        if (res.data.code == 1) {\n          _this7.access_buts = res.data.data;\n\n          if (button_access_ids) {\n            _this7.button_access_ids = button_access_ids;\n          }\n        } else {\n          _this7.$message.warning(res.data.msg);\n        }\n      });\n    },\n    //关闭弹窗\n    closeDialog: function closeDialog() {\n      this.access_name = \"\";\n      this.menu_id = \"\";\n      this.is_button = 0; //是否按钮\n\n      this.button_name = \"\";\n      this.selController = \"\"; //当前选择的控制器名称\n\n      this.selMethod = \"\"; //当前选择的方法名称\n\n      this.accessCodes = [];\n      this.button_access_ids = [];\n    },\n    //点击删除\n    accessDel: function accessDel(id) {\n      var _this8 = this;\n\n      this.$confirm(\"确认删除该权限?\", \"提示\", {\n        confirmButtonText: \"确定\",\n        cancelButtonText: \"取消\",\n        type: \"warning\"\n      }).then(function () {\n        resource.accessDel({\n          id: id\n        }).then(function (res) {\n          if (res.data.code == 1) {\n            _this8.$message.success(res.data.msg); //获取列表\n\n\n            _this8.getData();\n          } else {\n            _this8.$message.warning(res.data.msg);\n          }\n        });\n      }).catch(function () {\n        _this8.$message({\n          type: \"info\",\n          message: \"取消\"\n        });\n      });\n    },\n    //点击确认\n    commitFn: function commitFn() {\n      var _this9 = this;\n\n      if (this.access_name == \"\") {\n        this.$message.warning(\"请输入权限资源名称\");\n      } else if (this.menu_id == \"\") {\n        this.$message.warning(\"请选择所属菜单\");\n      } else if (this.is_button == 1 && this.button_name == \"\") {\n        this.$message.warning(\"请输入按钮名称\");\n      } else {\n        if (this.accessCodes.length == 0) {\n          if (this.selController == \"\" || this.selMethod == \"\") {\n            this.$message.warning(\"请选择权限码\");\n            return;\n          } else {\n            var str = this.selController + \"/\" + this.selMethod;\n            this.accessCodes.push(str);\n          }\n        }\n\n        var arg = {\n          access_name: this.access_name,\n          menu_id: this.menu_id,\n          access_codes: JSON.stringify(this.accessCodes),\n          is_button: this.is_button,\n          button_name: this.button_name,\n          button_access_ids: this.button_access_ids.join(\",\")\n        };\n\n        if (this.type == \"1\") {\n          //添加\n          resource.accessAdd(arg).then(function (res) {\n            if (res.data.code == 1) {\n              _this9.$message.success(res.data.msg);\n\n              _this9.show_dialog = false; //获取列表\n\n              _this9.getData();\n            } else {\n              _this9.$message.warning(res.data.msg);\n            }\n          });\n        } else {\n          arg.id = this.id;\n          resource.accessEdit(arg).then(function (res) {\n            if (res.data.code == 1) {\n              _this9.$message.success(res.data.msg);\n\n              _this9.show_dialog = false; //获取列表\n\n              _this9.getData();\n            } else {\n              _this9.$message.warning(res.data.msg);\n            }\n          });\n        }\n      }\n    },\n    //分页\n    checkPage: function checkPage(v) {\n      this.page = v; //获取列表\n\n      this.getData();\n    }\n  },\n  components: {\n    TableTitle: TableTitle,\n    PaginationWidget: PaginationWidget\n  }\n};",{"version":3,"mappings":";AA0EA;AACA;AAEA;AACA;EACAA,IADA,kBACA;IACA;MACAC,cADA;MAEAD,QAFA;MAEA;MACAE,eAHA;MAGA;MACAC,OAJA;MAIA;MACAC,aALA;MAKA;MACAC,MANA;MAMA;MACAC,kBAPA;MAOA;MACAC,QARA;MAQA;MACAC,gBATA;MASA;MACAC,eAVA;MAUA;MACAC,aAXA;MAWA;MACAC;QACAC,sBADA;QAEAC,eAFA;QAGAC,kBAHA;QAIAC,gBAJA;QAKAC;MALA,CAZA;MAmBAC,WAnBA;MAmBA;MACAC,cApBA;MAoBA;MACAC,iBArBA;MAqBA;MACAC,cAtBA;MAsBA;MACAC,aAvBA;MAuBA;MACAC,eAxBA;MAwBA;MACAC,YAzBA;MAyBA;MACAC,eA1BA;MA0BA;MACAC,eA3BA;MA2BA;MACAC,qBA5BA,CA4BA;;IA5BA;EA8BA,CAhCA;EAiCAC,OAjCA,qBAiCA;IACA;IACA;EACA,CApCA;EAqCAC;IACAT;MACA;QACA;QACA;QACA;MACA;IACA;EAPA,CArCA;EA8CAU,SA9CA,uBA8CA;IACAC;EACA,CAhDA;EAiDAC,OAjDA,qBAiDA;IACA;IACA;IACAD;EACA,CArDA;EAsDAE;IACA;IACAC,QAFA,sBAEA;MAAA;;MACA;QACA;QACA;QACA;QACA,mBACAC,kBACAC,kBADA,GAEAC,iBAFA,GAGA,EAHA,GAIA,IALA;MAMA,CAVA;IAWA,CAdA;IAeA;IACAC,OAhBA,qBAgBA;MAAA;;MACA;QACAC,YADA;QAEAnC;MAFA;MAIA;MACAoC;QACA;UACA;UACA;UACA;QACA,CAJA,MAIA;UACA;QACA;MACA,CARA;IASA,CA/BA;IAgCA;IACAC,KAjCA,iBAiCAjC,IAjCA,EAiCAF,EAjCA,EAiCA;MACA,iBADA,CAEA;;MACA,eAHA,CAIA;;MACA;;MACA;QAAA;QACA;QACA;MACA,CAHA,MAGA;QAAA;QACA;QACA,2BAFA,CAGA;;QACA;MACA;;MACA;IACA,CAjDA;IAkDA;IACAoC,OAnDA,qBAmDA;MAAA;;MACAF;QACA;UACA;QACA,CAFA,MAEA;UACA;QACA;MACA,CANA;IAOA,CA3DA;IA4DA;IACAG,UA7DA,wBA6DA;MAAA;;MACA;QACArC;MADA;MAGAkC;QACA;UACA;UACA;UACA;UACA;UACA,0BALA,CAKA;;UACA,sBANA,CAMA;;UACA,kCAPA,CAOA;;UACA;UACA;UACA;YACA;UACA,CAFA,EAVA,CAaA;;UACA;QACA,CAfA,MAeA;UACA;QACA;MACA,CAnBA;IAoBA,CArFA;IAsFA;IACAI,cAvFA,4BAuFA;MAAA;;MACAJ;QACA;UACA;QACA,CAFA,MAEA;UACA;QACA;MACA,CANA;IAOA,CA/FA;IAgGA;IACAK,SAjGA,uBAiGA;MAAA;;MACA;QACAC;MADA;MAGAN;QACA;UACA;QACA,CAFA,MAEA;UACA;QACA;MACA,CANA;IAOA,CA5GA;IA6GA;IACAO,aA9GA,2BA8GA;MACA;QACA;MACA,CAFA,MAEA;QACA;;QACA;UACA;YACA;YACA;UACA;QACA;;QACA;MACA;IACA,CA3HA;IA4HA;IACAC,WA7HA,uBA6HAC,KA7HA,EA6HA;MACA;IACA,CA/HA;IAgIA;IACAC,UAjIA,sBAiIAhC,OAjIA,EAiIAS,iBAjIA,EAiIA;MAAA;;MACA;QACAT;MADA;MAGAsB;QACA;UACA;;UACA;YACA;UACA;QACA,CALA,MAKA;UACA;QACA;MACA,CATA;IAUA,CA/IA;IAgJA;IACAW,WAjJA,yBAiJA;MACA;MACA;MACA,mBAHA,CAGA;;MACA;MACA,wBALA,CAKA;;MACA,oBANA,CAMA;;MACA;MACA;IACA,CA1JA;IA2JA;IACAC,SA5JA,qBA4JA9C,EA5JA,EA4JA;MAAA;;MACA;QACA+C,uBADA;QAEAC,sBAFA;QAGA9C;MAHA,GAKA+C,IALA,CAKA;QACAf;UAAAlC;QAAA;UACA;YACA,sCADA,CAEA;;;YACA;UACA,CAJA,MAIA;YACA;UACA;QACA,CARA;MASA,CAfA,EAgBAkD,KAhBA,CAgBA;QACA;UACAhD,YADA;UAEAiD;QAFA;MAIA,CArBA;IAsBA,CAnLA;IAoLA;IACAC,QArLA,sBAqLA;MAAA;;MACA;QACA;MACA,CAFA,MAEA;QACA;MACA,CAFA,MAEA;QACA;MACA,CAFA,MAEA;QACA;UACA;YACA;YACA;UACA,CAHA,MAGA;YACA;YACA;UACA;QACA;;QACA;UACAhD,6BADA;UAEAQ,qBAFA;UAGAyC,8CAHA;UAIAnC,yBAJA;UAKAC,6BALA;UAMAE;QANA;;QAQA;UACA;UACAa;YACA;cACA;;cACA,2BAFA,CAGA;;cACA;YACA,CALA,MAKA;cACA;YACA;UACA,CATA;QAUA,CAZA,MAYA;UACAoB;UACApB;YACA;cACA;;cACA,2BAFA,CAGA;;cACA;YACA,CALA,MAKA;cACA;YACA;UACA,CATA;QAUA;MACA;IACA,CAxOA;IAyOA;IACAqB,SA1OA,qBA0OAC,CA1OA,EA0OA;MACA,cADA,CAEA;;MACA;IACA;EA9OA,CAtDA;EAsSAC;IACAC,sBADA;IAEAC;EAFA;AAtSA","names":["data","loading","button_list","page","max_height","id","show_dialog","type","dialog_title","access_name","menu_list","props","expandTrigger","emitPath","label","value","children","menu_id","controller","selController","methodList","selMethod","accessCodes","is_button","button_name","access_buts","button_access_ids","created","watch","destroyed","window","mounted","methods","onResize","card_box_height","table_title_height","bottom_row_height","getData","pagesize","resource","addFn","getMenu","accessInfo","getControllers","getMethod","controller_name","addAccessCode","handleClose","index","changeMenu","closeDialog","accessDel","confirmButtonText","cancelButtonText","then","catch","message","commitFn","access_codes","arg","checkPage","v","components","TableTitle","PaginationWidget"],"sourceRoot":"src/pages/SupplyChain/pages/PermissionPages","sources":["entry_table.vue"],"sourcesContent":["<template>\n\t<div class=\"setting_content\">\n\t\t<el-card class=\"card_box\" id=\"card_box\">\n\t\t\t<TableTitle title=\"数据列表\" id=\"table_title\">\n\t\t\t\t<el-button size=\"mini\" type=\"primary\" @click=\"addFn('1')\" v-if=\"button_list.add == 1\">添加</el-button>\n\t\t\t</TableTitle>\n\t\t\t<el-table size=\"mini\" :data=\"data.data\" tooltip-effect=\"dark\" style=\"width: 100%\" :header-cell-style=\"{'background':'#f4f4f4','text-align': 'center'}\" :cell-style=\"{'text-align':'center'}\" :max-height=\"max_height\" v-loading=\"loading\">\n\t\t\t\t<el-table-column prop=\"access_name\" label=\"名称\" show-overflow-tooltip align=\"center\"></el-table-column>\n\t\t\t\t<el-table-column prop=\"menu_name\" label=\"所属分组\" show-overflow-tooltip align=\"center\"></el-table-column>\n\t\t\t\t<el-table-column prop=\"access_codes\" label=\"权限码\" show-overflow-tooltip align=\"center\"></el-table-column>\n\t\t\t\t<el-table-column label=\"操作\" align=\"center\" width=\"200\" fixed=\"right\">\n\t\t\t\t\t<template slot-scope=\"scope\">\n\t\t\t\t\t\t<el-button class=\"button_theme\" type=\"text\" size=\"small\" @click=\"addFn('2',scope.row.id)\"\n\t\t\t\t\t\tv-if=\"button_list.edit == 1\">编辑</el-button>\n\t\t\t\t\t\t<el-button class=\"button_theme\" type=\"text\" size=\"small\" @click=\"accessDel(scope.row.id)\" v-if=\"button_list.del == 1\">删除\n\t\t\t\t\t\t</el-button>\n\t\t\t\t\t</template>\n\t\t\t\t</el-table-column>\n\t\t\t</el-table>\n\t\t\t<PaginationWidget id=\"bottom_row\" :total=\"data.total\" :page=\"page\" @checkPage=\"checkPage\"/>\n\t\t</el-card>\n\t\t<!-- 添加或编辑 -->\n\t\t<el-dialog :close-on-click-modal=\"false\" :close-on-press-escape=\"false\" :show-close=\"false\" @close=\"closeDialog\" :visible.sync=\"show_dialog\">\n\t\t\t<div slot=\"title\" class=\"dialog_title\">\n\t\t\t\t<div>{{dialog_title}}</div>\n\t\t\t\t<img class=\"close_icon\" src=\"../../../../static/close_icon.png\" @click=\"show_dialog = false\">\n\t\t\t</div>\n\t\t\t<div class=\"dialog_content\">\n\t\t\t\t<el-form size=\"small\" label-width=\"150px\">\n\t\t\t\t\t<el-form-item label=\"权限资源名称：\">\n\t\t\t\t\t\t<el-input v-model=\"access_name\" style=\"width:192px\" placeholder=\"请输入权限资源名称\"></el-input>\n\t\t\t\t\t</el-form-item>\n\t\t\t\t\t<el-form-item label=\"所属菜单：\">\n\t\t\t\t\t\t<el-cascader v-model=\"menu_id\" :show-all-levels=\"false\" :options=\"menu_list\" :props=\"props\" @change=\"changeMenu\">\n\t\t\t\t\t\t</el-cascader>\n\t\t\t\t\t</el-form-item>\n\t\t\t\t\t<el-form-item label=\"添加权限码：\">\n\t\t\t\t\t\t<el-select v-model=\"selController\" placeholder=\"请选择\">\n\t\t\t\t\t\t\t<el-option v-for=\"item in controller\" :key=\"item\" :label=\"item\" :value=\"item\">\n\t\t\t\t\t\t\t</el-option>\n\t\t\t\t\t\t</el-select>\n\t\t\t\t\t\t<el-select v-model=\"selMethod\" placeholder=\"请选择\">\n\t\t\t\t\t\t\t<el-option v-for=\"item in methodList\" :key=\"item\" :label=\"item\" :value=\"item\">\n\t\t\t\t\t\t\t</el-option>\n\t\t\t\t\t\t</el-select>\n\t\t\t\t\t\t<el-button style=\"margin-left: 20px\" type=\"success\" icon=\"el-icon-plus\" circle @click=\"addAccessCode\"></el-button>\n\t\t\t\t\t\t<div style=\"margin-top: 10px;\">\n\t\t\t\t\t\t\t<el-tag style=\"margin-right: 20px;margin-bottom: 10px\" closable v-for=\"(item,index) in accessCodes\" :key=\"index\"\n\t\t\t\t\t\t\ttype=\"success\" effect=\"dark\" @close=\"handleClose(index)\"> {{ item }}\n\t\t\t\t\t\t</el-tag>\n\t\t\t\t\t</div>\n\t\t\t\t</el-form-item>\n\t\t\t\t<el-form-item label=\"是否按钮：\">\n\t\t\t\t\t<el-switch v-model=\"is_button\" :active-value=\"1\" :inactive-value=\"0\" active-color=\"#F37605\" inactive-color=\"#778899\">\n\t\t\t\t\t</el-switch>\n\t\t\t\t</el-form-item>\n\t\t\t\t<el-form-item label=\"按钮名称：\" v-if=\"is_button == 1\">\n\t\t\t\t\t<el-input v-model=\"button_name\" style='width: 300px;' placeholder=\"请输入按钮名称\"></el-input>\n\t\t\t\t</el-form-item>\n\t\t\t\t<el-form-item label=\"选择按钮：\" v-if=\"is_button == 0\">\n\t\t\t\t\t<el-checkbox-group v-model=\"button_access_ids\">\n\t\t\t\t\t\t<el-checkbox :label=\"item.id\" :key=\"item.id\" border v-for=\"item in access_buts\">{{item.access_name}}</el-checkbox>\n\t\t\t\t\t</el-checkbox-group>\n\t\t\t\t</el-form-item>\n\t\t\t</el-form>\n\t\t</div>\n\t\t<div slot=\"footer\" class=\"dialog_footer\">\n\t\t\t<el-button size=\"small\" @click=\"show_dialog = false\">取消</el-button>\n\t\t\t<el-button type=\"primary\" size=\"small\" @click=\"commitFn\">提交</el-button>\n\t\t</div>\n\t</el-dialog>\n</div>\n</template>\n<script>\n\timport TableTitle from '../../components/table_title.vue'\n\timport PaginationWidget from '../../../../components/pagination_widget.vue'\n\n\timport resource from '../../../../api/chain_resource.js'\n\texport default{\n\t\tdata(){\n\t\t\treturn{\n\t\t\t\tloading:false,\n\t\t\t\tdata:{},\t\t\t\t\t//返回数据\n\t\t\t\tbutton_list:{},\t\t\t\t//按钮权限\n\t\t\t\tpage:1,\t\t\t\t\t\t//当前页码\n\t\t\t\tmax_height:0,\t\t\t\t//表格最大高度\n\t\t\t\tid:\"\",\t\t\t\t\t\t//点击的ID\n\t\t\t\tshow_dialog:false,\t\t\t//添加或编辑弹窗\n\t\t\t\ttype:\"\",\t\t\t\t\t//弹窗类型（1:添加；2:查看；3编辑）\n\t\t\t\tdialog_title:\"\",\t\t\t//弹窗标题\n\t\t\t\taccess_name: \"\", //权限资源名称\n\t\t\t    menu_list: [], //所属菜单列表\n\t\t\t    props: {\n\t\t\t    \texpandTrigger: \"hover\",\n\t\t\t    \temitPath: false,\n\t\t\t    \tlabel: \"menu_name\",\n\t\t\t    \tvalue: \"menu_id\",\n\t\t\t    \tchildren: \"list\",\n\t\t\t    },\n\t\t\t    menu_id: \"\", //选中的菜单ID\n\t\t\t    controller: [], //所有控制器列表\n\t\t\t    selController: \"\", //当前选择的控制器名称\n\t\t\t    methodList: [], //控制器下所有方法\n\t\t\t    selMethod: \"\", //当前选择的方法名称\n\t\t\t    accessCodes: [], //选中的所有权限码列表\n\t\t\t    is_button: 0, //是否按钮\n\t\t\t    button_name: \"\", //按钮名称\n\t\t\t    access_buts: [], //权限按钮列表\n\t\t\t    button_access_ids: [], //选中的权限按钮列表\n\t\t\t}\n\t\t},\n\t\tcreated(){\n\t\t\t//获取列表\n\t\t\tthis.getData();\n\t\t},\n\t\twatch: {\n\t\t\tselController: function (n, o) {\n\t\t\t\tif (n != o && n != \"\") {\n        \t\t\t//获取所有控制器列表\n        \t\t\tthis.getMethod();\n        \t\t\tthis.selMethod = \"\";\n        \t\t}\n        \t},\n        },\n        destroyed() {\n        \twindow.removeEventListener(\"resize\", () => {});\n        },\n        mounted() {\n    \t\t//获取表格最大高度\n    \t\tthis.onResize();\n    \t\twindow.addEventListener(\"resize\", this.onResize());\n    \t},\n    \tmethods: {\n    \t\t//监听屏幕大小变化\n    \t\tonResize() {\n    \t\t\tthis.$nextTick(() => {\n    \t\t\t\tlet card_box_height = document.getElementById(\"card_box\").offsetHeight;\n    \t\t\t\tlet table_title_height = document.getElementById(\"table_title\").offsetHeight;\n    \t\t\t\tlet bottom_row_height = document.getElementById(\"bottom_row\").offsetHeight;\n    \t\t\t\tthis.max_height =\n    \t\t\t\tcard_box_height -\n    \t\t\t\ttable_title_height -\n    \t\t\t\tbottom_row_height -\n    \t\t\t\t55 +\n    \t\t\t\t\"px\";\n    \t\t\t});\n    \t\t},\n\t\t\t//获取列表\n\t\t\tgetData(){\n\t\t\t\tlet arg = {\n\t\t\t\t\tpagesize:10,\n\t\t\t\t\tpage:this.page\n\t\t\t\t}\n\t\t\t\tthis.loading = true;\n\t\t\t\tresource.accessList(arg).then(res => {\n\t\t\t\t\tif(res.data.code == 1){\n\t\t\t\t\t\tthis.loading = false;\n\t\t\t\t\t\tthis.data = res.data.data;\n\t\t\t\t\t\tthis.button_list = this.data.button_list;\n\t\t\t\t\t}else{\n\t\t\t\t\t\tthis.$message.warning(res.data.msg);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\n\t\t\t//点击添加或编辑\n\t\t\taddFn(type,id){\n\t\t\t\tthis.type = type;\n\t\t\t\t//获取所有菜单列表\n\t\t\t\tthis.getMenu();\n      \t\t\t//获取所有控制器列表\n      \t\t\tthis.getControllers();\n\t\t\t\tif(type == '1'){\t//添加\n\t\t\t\t\tthis.id = \"\";\n\t\t\t\t\tthis.dialog_title = '添加权限';\n\t\t\t\t}else{\t//编辑\n\t\t\t\t\tthis.id = id;\n\t\t\t\t\tthis.dialog_title = '编辑权限';\n\t\t\t\t\t//获取权限详情\n\t\t\t\t\tthis.accessInfo();\n\t\t\t\t}\n\t\t\t\tthis.show_dialog = true;\n\t\t\t},\n\t\t\t//获取所有菜单列表\n\t\t\tgetMenu() {\n\t\t\t\tresource.getMainMenus().then((res) => {\n\t\t\t\t\tif (res.data.code == 1) {\n\t\t\t\t\t\tthis.menu_list = res.data.data.menu_list;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.$message.warning(res.data.msg);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\t//获取权限详情\n\t\t\taccessInfo() {\n\t\t\t\tlet arg = {\n\t\t\t\t\tid: this.id,\n\t\t\t\t};\n\t\t\t\tresource.accessInfo(arg).then((res) => {\n\t\t\t\t\tif (res.data.code == 1) {\n\t\t\t\t\t\tlet data = res.data.data;\n\t\t\t\t\t\tthis.access_name = data.access_name;\n\t\t\t\t\t\tthis.menu_id = data.menu_id;\n\t\t\t\t\t\tthis.accessCodes = data.access_codes;\n          \t\t\t\tthis.selController = \"\"; //当前选择的控制器名称\n         \t\t\t \tthis.selMethod = \"\"; //当前选择的方法名称\n          \t\t\t\tthis.is_button = data.is_button; //是否按钮\n          \t\t\t\tthis.button_name = data.button_name;\n          \t\t\t\tlet strArr = data.button_access_ids.split(\",\");\n          \t\t\t\tlet intArr = strArr.map((item) => {\n          \t\t\t\t\treturn +item;\n          \t\t\t\t});\n          \t\t\t\t//选择按钮的列表\n          \t\t\t\tthis.changeMenu(this.menu_id, intArr);\n          \t\t\t} else {\n          \t\t\t\tthis.$mesage.warning(res.data.msg);\n          \t\t\t}\n          \t\t});\n\t\t\t},\n    \t\t//获取所有控制器列表\n    \t\tgetControllers() {\n    \t\t\tresource.getControllers().then((res) => {\n    \t\t\t\tif (res.data.code == 1) {\n    \t\t\t\t\tthis.controller = res.data.data;\n    \t\t\t\t} else {\n    \t\t\t\t\tthis.$message.warning(res.data.msg);\n    \t\t\t\t}\n    \t\t\t});\n    \t\t},\n    \t\t//获取所有控制器下面的方法列表\n    \t\tgetMethod() {\n    \t\t\tlet arg = {\n    \t\t\t\tcontroller_name: this.selController,\n    \t\t\t};\n    \t\t\tresource.getMethods(arg).then((res) => {\n    \t\t\t\tif (res.data.code == 1) {\n    \t\t\t\t\tthis.methodList = res.data.data;\n    \t\t\t\t} else {\n    \t\t\t\t\tthis.$message.warning(res.data.msg);\n    \t\t\t\t}\n    \t\t\t});\n    \t\t},\n    \t\t//点击弹框的添加权限码\n    \t\taddAccessCode() {\n    \t\t\tif (this.selController == \"\" || this.selMethod == \"\") {\n    \t\t\t\tthis.$message.warning(\"请完善当前权限码\");\n    \t\t\t} else {\n    \t\t\t\tlet str = this.selController + \"/\" + this.selMethod;\n    \t\t\t\tfor (var i = 0; i < this.accessCodes.length; i++) {\n    \t\t\t\t\tif (this.accessCodes[i] == str) {\n    \t\t\t\t\t\tthis.$message.warning(\"已存在该权限码\");\n    \t\t\t\t\t\treturn;\n    \t\t\t\t\t}\n    \t\t\t\t}\n    \t\t\t\tthis.accessCodes.push(str);\n    \t\t\t}\n    \t\t},\n    \t\t//点击某一个关闭\n    \t\thandleClose(index) {\n    \t\t\tthis.accessCodes.splice(index, 1);\n    \t\t},\n    \t\t//选择按钮的列表\n    \t\tchangeMenu(menu_id, button_access_ids) {\n    \t\t\tlet arg = {\n    \t\t\t\tmenu_id: menu_id,\n    \t\t\t};\n    \t\t\tresource.ajaxAccess(arg).then((res) => {\n    \t\t\t\tif (res.data.code == 1) {\n    \t\t\t\t\tthis.access_buts = res.data.data;\n    \t\t\t\t\tif (button_access_ids) {\n    \t\t\t\t\t\tthis.button_access_ids = button_access_ids;\n    \t\t\t\t\t}\n    \t\t\t\t} else {\n    \t\t\t\t\tthis.$message.warning(res.data.msg);\n    \t\t\t\t}\n    \t\t\t});\n    \t\t},\n\t\t\t//关闭弹窗\n\t\t\tcloseDialog(){\n\t\t\t\tthis.access_name = \"\";\n\t\t\t\tthis.menu_id = \"\";\n      \t\t\tthis.is_button = 0; //是否按钮\n      \t\t\tthis.button_name = \"\";\n      \t\t\tthis.selController = \"\"; //当前选择的控制器名称\n      \t\t\tthis.selMethod = \"\"; //当前选择的方法名称\n      \t\t\tthis.accessCodes = [];\n      \t\t\tthis.button_access_ids = [];\n      \t\t},\n      \t\t//点击删除\n      \t\taccessDel(id) {\n      \t\t\tthis.$confirm(\"确认删除该权限?\", \"提示\", {\n      \t\t\t\tconfirmButtonText: \"确定\",\n      \t\t\t\tcancelButtonText: \"取消\",\n      \t\t\t\ttype: \"warning\",\n      \t\t\t})\n      \t\t\t.then(() => {\n      \t\t\t\tresource.accessDel({ id: id }).then((res) => {\n      \t\t\t\t\tif (res.data.code == 1) {\n      \t\t\t\t\t\tthis.$message.success(res.data.msg);\n              \t\t\t\t//获取列表\n              \t\t\t\tthis.getData();\n              \t\t\t} else {\n              \t\t\t\tthis.$message.warning(res.data.msg);\n              \t\t\t}\n              \t\t});\n      \t\t\t})\n      \t\t\t.catch(() => {\n      \t\t\t\tthis.$message({\n      \t\t\t\t\ttype: \"info\",\n      \t\t\t\t\tmessage: \"取消\",\n      \t\t\t\t});\n      \t\t\t});\n      \t\t},\n\t\t\t//点击确认\n\t\t\tcommitFn(){\n\t\t\t\tif (this.access_name == \"\") {\n\t\t\t\t\tthis.$message.warning(\"请输入权限资源名称\");\n\t\t\t\t} else if (this.menu_id == \"\") {\n\t\t\t\t\tthis.$message.warning(\"请选择所属菜单\");\n\t\t\t\t} else if (this.is_button == 1 && this.button_name == \"\") {\n\t\t\t\t\tthis.$message.warning(\"请输入按钮名称\");\n\t\t\t\t} else {\n\t\t\t\t\tif (this.accessCodes.length == 0) {\n\t\t\t\t\t\tif (this.selController == \"\" || this.selMethod == \"\") {\n\t\t\t\t\t\t\tthis.$message.warning(\"请选择权限码\");\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlet str = this.selController + \"/\" + this.selMethod;\n\t\t\t\t\t\t\tthis.accessCodes.push(str);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tlet arg = {\n\t\t\t\t\t\taccess_name: this.access_name,\n\t\t\t\t\t\tmenu_id: this.menu_id,\n\t\t\t\t\t\taccess_codes: JSON.stringify(this.accessCodes),\n\t\t\t\t\t\tis_button: this.is_button,\n\t\t\t\t\t\tbutton_name: this.button_name,\n\t\t\t\t\t\tbutton_access_ids: this.button_access_ids.join(\",\"),\n\t\t\t\t\t};\n\t\t\t\t\tif (this.type == \"1\") {\n          \t\t\t\t//添加\n          \t\t\t\tresource.accessAdd(arg).then((res) => {\n          \t\t\t\t\tif (res.data.code == 1) {\n          \t\t\t\t\t\tthis.$message.success(res.data.msg);\n          \t\t\t\t\t\tthis.show_dialog = false;\n              \t\t\t\t\t//获取列表\n              \t\t\t\t\tthis.getData();\n              \t\t\t\t} else {\n              \t\t\t\t\tthis.$message.warning(res.data.msg);\n              \t\t\t\t}\n              \t\t\t});\n          \t\t\t} else {\n          \t\t\t\targ.id = this.id;\n          \t\t\t\tresource.accessEdit(arg).then((res) => {\n          \t\t\t\t\tif (res.data.code == 1) {\n          \t\t\t\t\t\tthis.$message.success(res.data.msg);\n          \t\t\t\t\t\tthis.show_dialog = false;\n              \t\t\t\t\t//获取列表\n              \t\t\t\t\tthis.getData();\n              \t\t\t\t} else {\n              \t\t\t\t\tthis.$message.warning(res.data.msg);\n              \t\t\t\t}\n              \t\t\t});\n          \t\t\t}\n          \t\t}\n          \t},\n\t\t\t//分页\n\t\t\tcheckPage(v){\n\t\t\t\tthis.page = v;\n\t\t\t\t//获取列表\n\t\t\t\tthis.getData();\n\t\t\t}\n\t\t},\n\t\tcomponents:{\n\t\t\tTableTitle,\n\t\t\tPaginationWidget\n\t\t}\n\t}\n</script>\n<style lang=\"less\" scoped>\n.setting_content{\n\tflex:1;\n\tposition: relative;\n\t.card_box{\n\t\tposition: absolute;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\twidth: 100%;\n\t\theight: 100%;\n\t}\n}\n.dialog_content{\n\tpadding-top: 50rem;\n\tpadding-bottom: 20rem;\n\t\n}\n</style>"]}]}